# ReactFlow TypeScript Demo

这是一个使用 TypeScript 和 ReactFlow (现在叫 @xyflow/react) 构建的流程图演示项目。该项目展示了 ReactFlow 的核心功能，包括节点管理、连接创建和交互操作。

## 功能特点

- 🎯 支持三种类型的节点：输入节点、默认节点和输出节点
- 🔄 节点可以自由拖拽
- 🔌 支持节点之间的连接创建
- 🗺️ 包含小地图导航功能
- 🔍 支持画布缩放和平移
- ➕ 动态添加新节点
- 🎨 美观的点状背景

## 技术栈

- React 18
- TypeScript
- @xyflow/react (ReactFlow) 12.4.4
- Vite

## ReactFlow 核心技术实现

ReactFlow 是一个强大的流程图库，其核心技术实现包含以下几个关键部分：

### 1. 节点系统
- **虚拟化渲染**：使用 React 的虚拟 DOM 和自定义的虚拟化系统，只渲染视口内的节点，提高大量节点时的性能
- **节点定位**：使用 CSS transform 进行节点定位，结合 React 的 state 管理，实现流畅的拖拽和位置更新
- **节点类型系统**：通过 React 组件系统实现可扩展的节点类型，支持自定义节点样式和行为

### 2. 连线系统
- **贝塞尔曲线**：使用 SVG 路径和贝塞尔曲线算法，实现平滑的连线效果
- **连线验证**：实现连线规则验证系统，确保连线的有效性
- **连线交互**：通过事件系统处理连线的创建、删除和更新

### 3. 画布系统
- **缩放和平移**：使用 CSS transform 和 matrix 变换，实现高性能的画布缩放和平移
- **视口管理**：实现视口裁剪和坐标转换，确保节点和连线在正确的位置显示
- **事件系统**：自定义事件系统处理画布级别的交互（如拖拽、缩放等）

### 4. 状态管理
- **不可变数据流**：使用不可变数据结构管理节点和边的状态，确保状态更新的可预测性
- **状态同步**：实现节点位置、连线等状态的实时同步
- **撤销/重做**：通过状态历史记录实现操作的撤销和重做

### 5. 性能优化
- **渲染优化**：
  - 使用 `React.memo` 和 `useMemo` 优化组件重渲染
  - 实现节点和连线的按需渲染
  - 使用 Web Workers 处理复杂计算
- **事件优化**：
  - 使用事件委托处理节点事件
  - 实现事件节流和防抖
  - 优化拖拽性能

### 6. 扩展性设计
- **插件系统**：提供插件机制，支持功能扩展
- **自定义组件**：支持自定义节点、边和控件
- **主题系统**：支持自定义主题和样式

## 快速开始

1. 安装依赖：
```bash
pnpm install
```

2. 启动开发服务器：
```bash
pnpm start
```

3. 在浏览器中访问：
```
http://localhost:5174
```

## 使用说明

### 基本操作

- **拖拽节点**：点击并拖动节点到任意位置
- **创建连接**：从节点的连接点拖出到另一个节点的连接点
- **缩放画布**：使用右下角的控制按钮或鼠标滚轮
- **平移画布**：按住鼠标左键拖动空白处
- **添加新节点**：点击左上角的"添加新节点"按钮

### 节点类型

- **输入节点**：蓝色边框，表示数据输入
- **默认节点**：灰色边框，用于处理数据
- **输出节点**：红色边框，表示数据输出

## 项目结构

```
src/
  ├── App.tsx          # 主应用组件
  ├── index.tsx        # 应用入口
  ├── index.css        # 全局样式
  └── index.html       # HTML 模板
```

## 开发说明

- 使用 TypeScript 确保类型安全
- 使用 React Hooks 管理状态
- 使用 Vite 作为构建工具
- 使用 pnpm 作为包管理器

## 注意事项

- 确保 Node.js 版本 >= 16
- 推荐使用 pnpm 作为包管理器
- 项目使用 TypeScript 严格模式
